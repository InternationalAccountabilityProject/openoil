<link rel="import" href="../components/polymer/polymer.html">
<link rel="import" href="../components/font-roboto/roboto.html">
<link rel="import" href="../components/core-scaffold/core-scaffold.html">
<link rel="import" href="../components/core-header-panel/core-header-panel.html">
<link rel="import" href="../components/core-field/core-field.html">
<link rel="import" href="../components/core-icon/core-icon.html">
<link rel="import" href="../components/core-icons/iconsets/image-icons.html">
<link rel="import" href="../components/core-item/core-item.html">
<link rel="import" href="../components/core-menu/core-menu.html">
<link rel="import" href="../components/core-menu/core-submenu.html">
<link rel="import" href="../components/core-menu-button/core-menu-button.html">
<link rel="import" href="../components/core-icon-button/core-icon-button.html">
<link rel="import" href="../components/core-toolbar/core-toolbar.html">
<link rel="import" href="../components/core-drawer-panel/core-drawer-panel.html">
<link rel="import" href="../components/paper-tabs/paper-tabs.html"> 
<link rel="import" href="../components/paper-slider/paper-slider.html"> 
<link rel="import" href="../components/paper-shadow/paper-shadow.html"> 
<link rel="import" href="../components/paper-item/paper-item.html"> 
<link rel="import" href="../components/paper-button/paper-button.html"> 
<link rel="import" href="../components/paper-icon-button/paper-icon-button.html"> 
<link rel="import" href="../components/paper-menu-button/paper-menu-button.html"> 
<link rel="import" href="../components/iilab-drawer-panel/iilab-drawer-panel.html">
<link rel="import" href="../components/core-transition/core-transition-css.html">
<link rel="import" href="../components/core-overlay/core-overlay.html">
<link rel="import" href="../components/core-ajax/core-xhr.html">
<link rel="import" href="iilab-graph.html"> 
<link rel="import" href="iilab-controls.html"> 
<link rel="import" href="iilab-search.html"> 

<polymer-element name="x-dialog" attributes="opened autoCloseDisabled">
<template>
  <style>

    :host {
      box-sizing: border-box;
      -moz-box-sizing: border-box;
      font-family: Arial, Helvetica, sans-serif;
      font-size: 13px;
      -webkit-user-select: none;
      -moz-user-select: none;
      overflow: hidden;
      background: white;
      padding:30px 42px;
      outline: 1px solid rgba(0,0,0,0.2);
      box-shadow: 0 4px 16px rgba(0,0,0,0.2);
    }
  </style>
  <core-overlay id="overlay" layered backdrop opened="{{opened}}" autoCloseDisabled="{{autoCloseDisabled}}"  transition="core-transition-center"></core-overlay>
  <content></content>
</template>
<script>

Polymer('x-dialog', {

  ready: function() {
    this.$.overlay.target = this;
  },

  toggle: function() {
    this.$.overlay.toggle();
  }

});

</script>
</polymer-element>

<polymer-element name="openoil-app" noscript>
  <template>
  <link rel="stylesheet" href="../components/jquery-ui/themes/ui-lightness/jquery-ui.css">

  <style shim-shadowdom>
    core-scaffold core-toolbar {
      background: #EEE;
      color: #2a3e92;
    }

    core-drawer-panel #main > [main] {
     background: #FFF; 
    }
  </style>
  <style>

    core-header-panel {
      height: 100%;
      overflow: auto;
      -webkit-overflow-scrolling: touch; 
    }

  /*  polyfill-unscoped-rule {
      content: 'core-scaffold core-toolbar';
      background: #EEE;
      color: black;
    }

    polyfill-unscoped-rule {
      content: 'core-scaffold core-header-panel';
      background: #FFF;
      color: black;
    } */

    core-scaffold::shadow core-toolbar {
      background: #EEE;
      color: #2a3e92;
    }
    core-scaffold::shadow core-header-panel {
      background: #FFF;
      color: #2a3e92;
    }
    paper-tabs {
      width: 100%;
      -webkit-user-select: none;
      -moz-user-select: none;
      -ms-user-select: none;
      user-select: none;
    }
    .container {
      width: 80%;
      margin: 50px auto;
    }
    @media (min-width: 481px) {
      paper-tabs {
        width: 200px;
      }
      .container {
        width: 400px;
      }
    }
    :host {
      position: absolute;
      width: 100%;
      height: 100%;
      box-sizing: border-box;
      color: #2a3e92;
    }
    #core_toolbar {
      right: 0px;
      color: #2a3e92;
      fill: rgb(255, 255, 255);
      background-color: rgb(235, 235, 235);
    }
    #core_drawer_panel {
      position: absolute;
      top: 0px;
      right: 0px;
      bottom: 0px;
      left: 0px;
    }
    #core_icon {
      height: 24px;
      width: 24px;
    }

    core-icon-button::shadow core-icon {
      fill: #2a3e92 ;
    }
    #core_card {
      width: 300px;
      height: 300px;
      border-top-left-radius: 2px;
      border-top-right-radius: 2px;
      border-bottom-right-radius: 2px;
      border-bottom-left-radius: 2px;
      box-shadow: rgba(0, 0, 0, 0.0980392) 0px 2px 4px, rgba(0, 0, 0, 0.0980392) 0px 0px 3px;
      left: 20px;
      top: 80px;
      position: absolute;
      background-color: rgb(255, 255, 255);
    }

    .ui-widget {
      font-family: RobotoDraft, sans-serif;
    }

    .ui-widget-content .ui-state-focus {
      color: #2a3e92;
      background: none;
      border: none;
    }

  </style>
  <core-xhr id="xhr"></core-xhr>
  <x-dialog id="dialog" class="dialog">
      <!-- place all overlay styles inside the overlay target -->
      <style no-shim>
        .dialog {
          box-sizing: border-box;
          -moz-box-sizing: border-box;
          font-family: Arial, Helvetica, sans-serif;
          font-size: 13px;
          -webkit-user-select: none;
          -moz-user-select: none;
          overflow: hidden;
          background: white;
          padding:30px 42px;
          outline: 1px solid rgba(0,0,0,0.2);
          box-shadow: 0 4px 16px rgba(0,0,0,0.2);
        }

        #dialog {
          width: 500px;
        }

        #dialog paper-icon-button {
          width: 200px;
        }
      </style>
      <div layout horizontal center>
        <core-icon icon="home" size="60px" style="margin-right:15px;"></core-icon>
        <h2>OpenOil Data Navigator</h2>
      </div>
      <div>Welcome to the OpenOil Data Navigator.</div><br><br>
      <div layout horizontal>
        <div layout vertical center flex one>
          <paper-icon-button raisedButton core-overlay-toggle label="BP" on-click="{{loadBP}}"></paper-icon-button>
          <h4>BP Corporate Structure</h4>
          <p>Curabitur imperdiet risus id enim bibendum vestibulum.</p>
        </div>
        <div layout vertical center flex one>
          <paper-icon-button raisedButton core-overlay-toggle label="Nigeria" on-click="{{loadNigeria}}"></paper-icon-button>
          <h4>Nigeria Contracts</h4>
          <p>Praesent lacinia congue erat nec mattis. Fusce commodo lacus est.</p>
        </div>
      </div>
      <br><br>
      <div layout vertical center>
        Explore the OpenOil data set through a map.
        <br><br>
        <paper-icon-button raisedButton core-overlay-toggle on-click="{{loadMap}}" label="Map"></paper-icon-button>
        <core-overlay layered id="confirmation" class="dialog" backdrop transition="core-transition-top">
          <!-- place all overlay styles inside the overlay target -->
          <style no-shim>
            .dialog {
              box-sizing: border-box;
              -moz-box-sizing: border-box;
              font-family: Arial, Helvetica, sans-serif;
              font-size: 13px;
              -webkit-user-select: none;
              -moz-user-select: none;
              overflow: hidden;
              background: white;
              padding:30px 42px;
              outline: 1px solid rgba(0,0,0,0.2);
              box-shadow: 0 4px 16px rgba(0,0,0,0.2);
            }

            #confirmation {
              box-sizing: border-box;
              text-align: center;
              width: 150px;
            }
          </style>
        </core-overlay>
      </div><br><br>
    </x-dialog>

    <core-scaffold id="core_scaffold">
      <core-header-panel mode="seamed" id="core_header_panel" navigation flex>
        <core-toolbar id="core_toolbar">
          <core-icon-button icon="home" id="home" on-click="{{homeClick}}"></core-icon-button>
          <core-icon-button icon="menu" id="core_icon_button"></core-icon-button>
        </core-toolbar>
        <core-icon src="/openoil_logo.png" size="128" style="margin-left:55px"></core-icon> 
        <core-field id="core_field" icon="search">
          <iilab-search search="{{searchText}}" id="iilab_search"></iilab-search>
        </core-field>
        <iilab-controls id="iilab_controls" cypher="{{cypherText}}" depth="{{depthValue}}"></iilab-controls>
        <paper-shadow z="1"></paper-shadow>
      </core-header-panel>
      <div id="div" tool horizontal layout center wrap flex>
        <div id="title" flex>Open&nbsp;Oil Data</div>
        <div>&nbsp;</div>
        <core-tooltip>
          <h5>Zoom</h5>
          <div tip>Drag the slider to change the zoom level.</div>
        </core-tooltip>
        <paper-slider id="zoom_slider" pin="" snaps="" min="-3.5" max="1" step="0.05" value="{{zoomSlider}}"></paper-slider>
        <paper-icon-button id="zoom_out" icon="image:crop-free" role="button" tabindex="0" class="" on-click="{{zoomOut}}"></paper-icon-button>
        <paper-menu-button icon="more-vert" valign="bottom" halign="right">
          <paper-item icon="visibility" label="About OpenOil"></paper-item>
          <paper-item icon="extension" label="Contribute"></paper-item>
          <paper-item icon="info" label="Sources"></paper-item>
        </paper-menu-button>      
      </div>
      <div id="selection"></div>
      <iilab-graph id="iilab_graph" cypher="{{cypherText}}" search="{{searchText}}" url="{{url}}" zoom="{{zoom}}" autozoom="{{autozoom}}" depth="{{depthValue}}"></iilab-graph>
      <!--<core-card id="core_card" layout vertical></core-card>-->
    </core-scaffold>
  </template>
  <script> 
  	Polymer('openoil-app', {
      url: (window.location.href == 'http://localhost/')?'http://db.localhost:7474/db/data/' : 'https://db_openoil.iilab.org/db/data/',
      zoom: 1,
      zoomSlider: 1,
  		published: {
  			title: ""
  		},
      domReady: function() {
        this.$.dialog.toggle();
        this.addEventListener('set-slider', this.sliderSet);
        this.addEventListener('stats', this.statsReq);
      },
      statsReq: function(e) {
        this.$.xhr.request({url:"?i=" + e.detail.i + "&t=" + e.detail.t })
      },
      loadBP: function() {
//        this.$.iilab_controls.shadowRoot.querySelector("#SavedQueries").selected = 1;
//        this.$.iilab_controls.shadowRoot.querySelector("#SavedQueriesBP").selected = 1;
        this.fire('load-query', {id: "bp_plc_2"});
      },
      loadNigeria: function() {
//        this.$.iilab_controls.shadowRoot.querySelector("#SavedQueries").selected = 1;
//        this.$.iilab_controls.shadowRoot.querySelector("#SavedQueriesBP").selected = 1;
        this.fire('load-query', {id: "nigeria_1"});
      },
      loadMap: function() {

      },
      homeClick: function() {
        this.$.dialog.toggle();
      },
  		buttonClick: function(e, detail, sender) {
  			document.querySelector('iilab-graph').shadowRoot.querySelector('#drawer').togglePanel();
  		},
      searchTextChanged: function(o, n) {
//        console.log(n)
      },
      stringsTextChanged: function(o, n) {
      },
      zoomOut: function() {
        this.$.iilab_graph.zoom = 1;
      },
      sliderSet: function(e) {
        console.log("openoil-app zoomChanged")
        console.log(e.detail.zoom)
        this.zoomSlider = Math.round(Math.log(e.detail.zoom)*20)/20
      },
      zoomSliderChanged: function(o,n) {
        console.log("openoil-app zoomSliderChanged")
        console.log(n)
        console.log(Math.exp(Math.round(n*20)/20))
        this.fire('zoom-slider', {zoom: Math.exp(Math.round(n*20)/20)})
//        this.$.iilab_graph.zoom = Math.exp(Math.round(n*20)/20);
//        this.$.iilab_graph.autozoom = false;
      }
  	})
  </script>
</polymer-element>